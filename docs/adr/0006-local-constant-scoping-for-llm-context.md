# ADR-0006: ファイルローカルでの定数スコープをLLM開発のために優先する

## ステータス

決定済み (2026-02-08)

## コンテキスト

GitHub Issue #84 にて、コードベース内のマジックナンバーを `lib/constants.ts` に集約する提案があった。具体的には以下の値:

- `1000` (ms) - `hooks/useSaveContent.ts` の保存デバウンス時間
- `5000` (ms) - `hooks/useSaveContent.ts` のエラー表示時間
- `5000` (ms) - `components/Toast.tsx` のトースト表示時間

一般的なソフトウェア開発のベストプラクティスでは、マジックナンバーを定数として抽出し、一箇所に集約することが推奨される。これにより以下のメリットが得られる:

- 値の変更が容易になる
- 同じ値を複数箇所で使う場合の一貫性が保たれる
- 定数名により意図が明確になる

しかし、このプロジェクトでは LLM によるコード生成・変更が開発の中心となっている。この文脈では、異なる判断基準が適用される。

## 決定

**定数が単一ファイル内でのみ使用される場合は、そのファイル内でローカルに定義する。**

複数のファイルで共有される定数のみ、共通の定数ファイル（`lib/constants.ts`）に配置する。

## 理由

### LLM 開発におけるコンテキストのコンパクト性

LLM がコードを理解・変更する際、関連するコンテキストが同じファイル内にまとまっていることで、必要な情報を一度に把握できる。定数を外部ファイルに配置すると、LLM は複数ファイルを横断して理解する必要が生じ、コンテキストウィンドウの効率的な利用が妨げられる。

### メリット・デメリットのトレードオフ

**ファイルローカルでの定数定義のメリット（LLM 開発時）:**

- コードの意図がファイル内で完結して理解できる
- 変更時に必要なファイルの数が少なくなる
- LLM のコンテキストウィンドウを効率的に活用できる

**デメリット:**

- 同じ値を複数ファイルで使う場合に重複が生じる可能性がある
- 値の一括変更が困難になる

### 適用条件の明確化

この決定は以下の条件下でのみ有効:

1. **定数が単一ファイル内でのみ使用される場合**
   複数ファイルで共有される場合は、依然として共通の定数ファイルに配置すべきである。これは LLM の観点からも、複数ファイルに重複した定数が存在する方が混乱を招くためである。

2. **適切に定数化されている場合**
   この決定は、マジックナンバーをそのまま埋め込むことを正当化するものではない。以下は依然として必要:
   - 意味のある定数名による定義（例: `const SAVE_DEBOUNCE_MS = 1000`）
   - ファイルの先頭付近への配置など、見通しを良くする工夫

### プロダクト哲学との整合性

このプロジェクトの「ノイズの排除」と「ミニマリズム」の原則は、コードにも適用される。LLM 開発において、不必要なファイル間の参照はノイズとなる。単一ファイル内で完結できる定数を外部化することは、このコンテキストでは複雑さの増加につながる。

## 影響

- `lib/constants.ts` は、複数ファイルで共有される定数のみを含む
- 単一ファイル内でのみ使用される定数は、そのファイル内でローカルに定義する
- 各ファイル内の定数は、適切な命名とファイル内での配置により可読性を確保する
- 将来的に定数が複数ファイルで使用されるようになった場合は、その時点で共通の定数ファイルへの移動を検討する

## 例

### 推奨される実装（単一ファイルで使用）

```typescript
// hooks/useSaveContent.ts
const SAVE_DEBOUNCE_MS = 1000;
const SAVE_ERROR_DISPLAY_MS = 5000;

export function useSaveContent() {
  // ... SAVE_DEBOUNCE_MS を使用
}
```

### 推奨される実装（複数ファイルで使用）

```typescript
// lib/constants.ts
export const ANIMATION_DURATION_MS = 200;

// components/ComponentA.tsx
import { ANIMATION_DURATION_MS } from '@/lib/constants';

// components/ComponentB.tsx
import { ANIMATION_DURATION_MS } from '@/lib/constants';
```

### 推奨されない実装

```typescript
// 直接埋め込まれたマジックナンバー（定数化されていない）
setTimeout(() => {
  setSaveError(null);
}, 5000); // ❌ この 5000 が何を意味するのか不明確
```
