# AGENTS.md

このファイルは、AIコーディングエージェントがこのプロジェクトで作業する際のガイドラインです。

## プロダクト概要

Markdown Board は、開いた瞬間から書き始められるミニマルな共同編集メモツールです。紙のノートやホワイトボードのように「深く考えずに様々なことを書き出せる」体験を提供します。

## プロダクト哲学

### ビジョン: 「悩む」から「考える」へ

頭の中のモヤモヤを書き出すことで、「悩んでいる」状態から「考えている」状態へ変化する。その瞬間を生み出すことがこのプロダクトの価値です。

### 5つのコア原則

1. **ノイズの排除** — UIの複雑さ、保存・同期の意識、フォーマットの強制など、ユーザーの思考を妨げるあらゆるノイズを排除する
2. **即座に始められる** — 開いた瞬間から書き始められること。学習コストをゼロに近づける
3. **ミニマリズム** — 機能は必要最小限に。「あったら便利かも」は追加しない
4. **リアルタイムの共有体験** — 複数人が同時に編集できるホワイトボードのような体験
5. **ストレスなく使える** — すべての操作は自然な挙動で、「遅い」と感じさせないスピードを保つ

## 技術構成

- **フレームワーク**: Next.js (App Router)
- **言語**: TypeScript
- **エディタ**: Milkdown (CommonMark準拠のMarkdownエディタ)
- **共同編集**: Yjs (CRDT) + WebSocket
- **データベース**: SQLite (better-sqlite3)
- **スタイリング**: Tailwind CSS
- **テスト**: Playwright (E2Eテスト)
- **リンター**: ESLint

## プロジェクト構造

```
app/                  # Next.js App Router
  api/pages/          # REST API (CRUD operations)
  api/archives/       # アーカイブ関連API
  page/[id]/          # エディタページ
  archives/           # アーカイブ一覧ページ
components/           # Reactコンポーネント
lib/                  # DB初期化、型定義
server/               # WebSocketサーバー (Yjs同期)
e2e/                  # Playwright E2Eテスト
```

## 開発コマンド

```bash
npm install           # 依存関係のインストール
npm run dev           # 開発サーバー起動 (Next.js + WebSocket)
npm run build         # プロダクションビルド
npm run lint          # ESLintによるコード品質チェック
npm run test:e2e      # Playwright E2Eテスト実行
```

## 開発ガイドライン

### やるべきこと

- 開いた瞬間から使える即時性を守る
- 保存や同期をユーザーに意識させない設計を維持する
- 機能追加の前に「本当に必要か」を問う
- シンプルさを維持する
- ユーザーの思考の流れを妨げないUXを心がける
- 変更後は `npm run lint` と `npm run test:e2e` で品質を確認する

### やってはいけないこと

- **機能の肥大化**: 「便利そう」という理由で機能を追加しない
- **カスタマイズ設定の追加**: ユーザーに選択を強いない
- **ワークフローの強制**: 特定の使い方を押し付けない
- **複雑な整理機能**: シンプルさを損なう階層化やタグ付けの過剰導入
- **学習を要するUI**: 説明が必要なインターフェースは設計の失敗

### 判断に迷ったら

1. **それがなくても目的は達成できないか？** — 達成できるなら、追加しない
2. **説明なしで使い方がわかるか？** — わからないなら、設計を見直す
3. **ユーザーの思考を中断させないか？** — 中断させるなら、やり方を変える

迷いが解消しないときは、**追加しない方を選ぶ**。後から足すことはできても、一度増えた複雑さを取り除くのは難しい。

## アーキテクチャ上の注意点

- **リアルタイム同期**: エディタの変更は Yjs CRDT を通じて WebSocket で他のクライアントに同期される。SQLite はバックアップとしての永続化層
- **自動保存**: エディタの変更はデバウンス（1秒）後にAPIを通じてSQLiteに保存される
- **タイトル抽出**: ページのタイトルはコンテンツの1行目から自動抽出される
- **アーカイブ**: ページの削除はソフトデリート（archived_at タイムスタンプ）で実装。30日後に完全削除
- **ID生成**: UUIDv7 を使用（時系列ソート可能）
