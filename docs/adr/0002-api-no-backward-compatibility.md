# ADR-0002: APIレスポンス形式の統一にあたり後方互換性を考慮しない

## ステータス

決定済み (2026-02-06)

## コンテキスト

GitHub Issue #37 にて、REST APIレスポンス形式の不整合が指摘された。具体的には:

- `POST /api/pages` は `{ id }` を返すが、他のエンドポイントは `{ success: true, ... }` を返す
- `GET /api/pages` と `GET /api/archives` はリスト構造が異なる（フィールドの差異）
- `POST /api/pages/[id]/archive` は `archived_at` を含むが、`POST /api/pages/[id]/unarchive` は含まない
- `DELETE /api/archives` は `{ deleted: number }` を返し、他と形式が異なる

この不整合を解消するにあたり、段階的な移行（deprecation period、バージョニングなど）の必要性を検討した。

## 決定

APIの後方互換性は考慮せず、一括で変更する。

## 理由

### APIの唯一のクライアントはこのプロダクト自身

このプロダクトのREST APIは、外部に公開されたパブリックAPIではなく、フロントエンド（Next.jsアプリケーション）からのみ呼び出される内部APIである。唯一のクライアントはこのプロダクト自身であるため、APIの変更時にフロントエンドも同時に更新すれば、互換性の問題は発生しない。

### 段階的移行のコストが利益を上回る

- バージョニングやdeprecation期間を設けると、移行期間中に新旧両方のレスポンス形式をサポートする必要がある
- これはコードの複雑さを増し、ミニマリズムの原則に反する
- 内部APIであるため、段階的移行の恩恵を受ける外部利用者が存在しない

### 一括変更のリスクが低い

- フロントエンドとバックエンドが同一リポジトリで管理されている（モノリポ構成）
- 変更は同一コミット/PRで完結するため、不整合が発生する期間が存在しない
- E2Eテストにより動作の正常性を検証できる

## 影響

- Issue #37 のAPIレスポンス統一を、後方互換性を気にせず一括で実施する
- フロントエンドのAPI呼び出し箇所も同時に更新する
- 将来APIを外部公開する場合は、その時点で改めてバージョニング戦略を検討する
