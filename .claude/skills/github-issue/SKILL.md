---
name: github-issue
description: GitHub Issue を読み、コードベースを調査し、実装・レビュー・コミットまでを一貫して行うスキル。Issue対応の全工程を自動化する。
user_invocable: true
arguments:
  - name: issue
    description: GitHub Issue の番号または URL
    required: true
---

# GitHub Issue 対応スキル

このスキルは、GitHub Issue の内容を理解し、コードベースの調査から実装・レビュー・コミットまでを一貫して実行するワークフローです。

以下のステップを**必ず順番通りに**実行してください。

---

## ステップ1: Issue の読み取りと理解

### 1-a: Issue の取得

Bash ツールで以下を実行し、Issue の内容を取得してください:

```bash
gh issue view <issue番号> --comments
```

引数が URL の場合は、番号部分を抽出して使用してください。

### 1-b: Issue の整理

取得した Issue から以下を整理してください:

- **目的**: この Issue は何を達成しようとしているか
- **カテゴリ**: バグ修正 / 機能追加 / 改善 / リファクタリング / ドキュメント
- **受け入れ条件**: Issue に記載された完了条件（チェックリストがあればそれを採用）
- **制約・注意事項**: Issue のコメントや本文に含まれる追加情報

### 1-c: ADR の確認

`docs/adr/` ディレクトリ内の ADR ファイルを確認し、この Issue の内容が過去に却下された判断と矛盾しないか確認してください。

矛盾する場合は、該当する ADR の番号と理由をユーザーに報告し、対応方針を確認してください。

---

## ステップ2: コードベースの調査

Task ツール（`subagent_type=Explore`）を使って、Issue に関連するコードを調査してください。

以下のプロンプトで Explore エージェントを起動してください:

> 以下の GitHub Issue に関連するコードを調査してください。
>
> 【Issue の目的とカテゴリをここに記載】
>
> 以下の観点で調査し、報告してください:
>
> - **関連ファイル**: 変更が必要なファイルの一覧とその役割
> - **影響範囲**: 変更が波及する可能性のあるファイルやコンポーネント
> - **既存の実装パターン**: プロジェクト内で類似の実装がある場合、そのパターン
> - **テスト**: 関連する既存テスト（E2E テスト、ユニットテスト）の有無と場所
> - **技術的制約**: 実装にあたって注意すべきアーキテクチャ上の制約

---

## ステップ3: 対応計画の策定

ステップ1とステップ2の情報をもとに、実装計画を策定してください。

### 計画に含めるべき内容

1. **変更ファイルの一覧**: 各ファイルで何を変更するか
2. **実装の順序**: ファイル間の依存関係を考慮した実装順序
3. **テスト方針**: 追加・修正すべきテストの内容
4. **コミット単位**: CLAUDE.md の「小さく独立したコミット」の原則に従い、どの単位でコミットを分けるか

### プロダクト哲学との整合性確認

機能追加・改善の場合は、CLAUDE.md の判断基準を適用してください:

1. **それがなくても目的は達成できないか？** → 達成できるなら、追加しない
2. **説明なしで使い方がわかるか？** → わからないなら、設計を見直す
3. **ユーザーの思考を中断させないか？** → 中断させるなら、やり方を変える

哲学に反する実装が含まれる場合は、Issue の意図を尊重しつつ、哲学に沿った代替案を計画に含めてください。

計画を TodoWrite ツールで TODO リストとして記録してください。

---

## ステップ4: 実装

ステップ3の計画に従い、実装を進めてください。

### 実装の進め方

- **独立した変更は並列に**: 依存関係のない変更は Task ツール（`subagent_type=general-purpose`）を使って並列に実装してください
- **依存関係のある変更は順番に**: 先行する変更が必要な場合は順番に実装してください

各サブエージェントへのプロンプトには以下を含めてください:

> 以下の変更を実装してください。
>
> 【変更内容の詳細（ファイルパス、変更内容、受け入れ条件）をここに記載】
>
> 実装にあたっての注意:
>
> - CLAUDE.md のプロダクト哲学・開発ガイドラインに従うこと
> - プロジェクトの既存のコーディングスタイルと一貫させること
> - 過剰な変更（不要なリファクタリング、コメント追加など）は行わないこと
> - CommonJS（`require()` / `module.exports`）は使用禁止。ESモジュールを使うこと

### 実装後の品質チェック

実装が完了したら、以下のコマンドを順番に実行してください:

```bash
npm run format
npm run lint
npm test
npm run test:e2e
```

失敗がある場合は修正し、すべて通るまで繰り返してください。

テストが環境の制約（ブラウザ未インストール、ネットワーク不通など）で実行できない場合は、実行可能なテスト（lint, unit test, build）のみで品質確認を行い、E2E テストがスキップされた旨を記録してください。

### コミット

品質チェックが通ったら、ステップ3で計画したコミット単位に従い、コミットしてください。コミットメッセージは変更内容を簡潔に表現してください。

各 TODO を完了としてマークしてください。

---

## ステップ5: レビューと改善

`/review-and-fix` スキルを実行し、変更範囲のレビューと改善を行ってください。

レビュー範囲には、この Issue 対応で変更したファイルを指定してください。具体的には、以下の引数で実行してください:

```
/review-and-fix mainブランチとの差分
```

`/review-and-fix` スキルが完了するまで待ち、結果を確認してください。

---

## ステップ6: 最終確認と報告

### 6-a: 受け入れ条件の確認

ステップ1で整理した受け入れ条件をすべて満たしているか確認してください。

満たしていない条件がある場合は、ステップ4に戻って追加実装を行ってください。

### 6-b: 最終品質チェック

以下のコマンドを実行し、最終的な品質を確認してください:

```bash
npm run format:check
npm run lint
npm test
npm run test:e2e
```

### 6-c: 結果の報告

以下の形式で結果を報告してください:

```
## Issue 対応完了

### 対応した Issue

- Issue: #<番号> <タイトル>
- カテゴリ: <バグ修正 / 機能追加 / 改善 / リファクタリング / ドキュメント>

### 変更内容

- 変更1の概要
- 変更2の概要
- ...

### 変更ファイル

- `ファイルパス1`: 変更内容の概要
- `ファイルパス2`: 変更内容の概要
- ...

### テスト結果

- lint: OK / NG
- unit test: OK / NG / スキップ
- E2E test: OK / NG / スキップ

### コミット

- `コミットハッシュ`: コミットメッセージ
- ...

### レビュー結果

- レビューサイクル数: N回
- 検出・修正した指摘: X件

### 受け入れ条件の充足

- [x] 条件1
- [x] 条件2
- ...
```
