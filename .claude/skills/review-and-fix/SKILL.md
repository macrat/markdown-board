---
name: review-and-fix
description: code-reviewer と ux-reviewer による自動レビュー＆修正サイクル。両レビュアーにコードをレビューさせ、指摘事項をサブエージェントに修正させる。指摘が無くなるまで繰り返し実行する。コード変更後にプロアクティブに使用すること。
---

# レビュー＆修正サイクル

このスキルは、code-reviewer と ux-reviewer にレビューを依頼し、検出された指摘事項をサブエージェントに修正させるワークフローです。指摘が無くなるまで繰り返し実行し、最後にクリーンなレビュー結果を確認して完了とします。

以下のステップを**必ず順番通りに**実行してください。

---

## ステップ1: レビューの実行

Task ツールを使って、以下の **2つのレビューエージェントを同時に（1つのメッセージで）** 起動してください。

### エージェント1: code-reviewer

```
subagent_type: code-reviewer
```

以下のプロンプトで起動:

> プロジェクト全体のコードをレビューしてください。
> CLAUDE.md を読み、プロジェクトの哲学・原則・技術構成を把握した上で、バグ・可読性・メンテナンス性・セキュリティ・パフォーマンスの問題を検出してください。
> 問題が見つからなかった場合は「コードに問題は見つかりませんでした」とだけ回答してください。

### エージェント2: ux-reviewer

```
subagent_type: ux-reviewer
```

以下のプロンプトで起動:

> プロジェクト全体の UI/UX をレビューしてください。
> CLAUDE.md を読み、プロダクト哲学・5つのコア原則を把握した上で、ユーザー体験を損なう要素がないかを検証してください。
> 問題が見つからなかった場合は「コードに問題は見つかりませんでした」とだけ回答してください。

---

## ステップ2: レビュー結果の確認

ステップ1で返ってきた2つのレビュー結果を確認してください。

### 指摘が無い場合

両方のレビュアーから「コードに問題は見つかりませんでした」という回答が返ってきた場合、**ステップ5（最終確認）**に進んでください。

### 指摘がある場合

検出された指摘事項を以下のように整理してください:

1. **重複の除去**: code-reviewer と ux-reviewer の指摘に重複がある場合はまとめる
2. **優先度順に整理**: Critical > Warning > Info の順に並べる
3. **修正単位にグルーピング**: 同じファイルや同じ機能に関する指摘をまとめて、修正しやすい単位にグルーピングする

整理した結果を TodoWrite ツールで TODO リストとして記録してください。

---

## ステップ3: 指摘事項の修正

ステップ2で整理した指摘事項を、グループごとにサブエージェントで修正します。

**独立したグループは並列に**、**依存関係があるグループは順番に**修正してください。

各グループの修正には Task ツール（`subagent_type: general-purpose`）を使い、以下の形式でプロンプトを渡してください:

> 以下のレビュー指摘事項を修正してください。
>
> 【指摘事項の内容をここに記載（ファイルパス、行番号、問題の説明、推奨される修正方法を含める）】
>
> 修正にあたっての注意:
>
> - CLAUDE.md のプロダクト哲学・開発ガイドラインに従うこと
> - 指摘された問題の修正に集中し、関係のないコードは変更しないこと
> - 修正後のコードがプロジェクトの既存のコーディングスタイルと一貫していること
> - 過剰な修正（不要なリファクタリング、コメント追加など）は行わないこと

修正が完了したら、各 TODO を完了としてマークしてください。

---

## ステップ4: 再レビュー（ループ）

すべての修正が完了したら、**ステップ1に戻って**再度レビューを実行してください。

このループは**指摘事項が無くなるまで繰り返し**ます。

**無限ループ防止**: ループは最大 **3回** までとします。3回目のレビューでまだ指摘がある場合は、残りの指摘事項を一覧にして報告し、ステップ5に進んでください。

---

## ステップ5: 最終確認

### 最終レビューの実行

ステップ1と同じ方法で、code-reviewer と ux-reviewer を**同時に**起動し、最終レビューを実行してください。

### 結果の報告

最終レビューの結果に基づいて、以下のサマリーを出力してください:

```
## レビュー＆修正サイクル完了

### サマリー

- **実行回数**: N回のレビュー＆修正サイクルを実行
- **検出した指摘の総数**: X件（Critical: A件、Warning: B件、Info: C件）
- **修正した指摘の数**: Y件
- **残存する指摘**: Z件（ある場合は詳細を記載）

### 修正内容

- 修正1の概要
- 修正2の概要
- ...

### 最終レビュー結果

[最終レビューの結果をここに記載]
```

### lint と E2E テストの実行

最後に以下のコマンドを順番に実行し、修正が既存の品質基準を満たしていることを確認してください:

```bash
npm run lint
npm run test:e2e
```

テストが失敗した場合は、失敗箇所を修正してから再度テストを実行してください。
